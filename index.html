<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¹Ù„Ø§Ø¡ Ø§Ù„Ø¯ÙŠÙ† - Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</title>
  <style>
    body {
      font-family: 'Cairo', 'Arial', sans-serif;
      background-color: #f8f8f8;
      margin: 0;
      padding: 40px 20px;
      text-align: center;
      color: #333;
    }

    .container {
      background-color: #fff;
      border-radius: 15px;
      padding: 30px 20px;
      max-width: 400px;
      margin: 0 auto;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      direction: rtl;
    }

    img {
      width: 120px;
      height: 120px;
      border-radius: 15px;
      object-fit: contain;
      display: block;
      margin: 0 auto 20px auto;
    }

    h1 {
      color: #4B0082;
      font-size: 22px;
      margin-bottom: 10px;
    }

    p {
      font-size: 16px;
      color: #555;
      margin: 0 0 15px 0;
    }

    input {
      width: 90%;
      padding: 10px;
      font-size: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-bottom: 15px;
      text-align: center;
    }

    button {
      background-color: #4B0082;
      color: #fff;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background-color: #6A0DAD;
    }

    footer {
      margin-top: 30px;
      font-size: 13px;
      color: #777;
    }

    .success {
      color: green;
      font-weight: bold;
    }

    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="https://qgwlcuxrudvdnmryajza.supabase.co/storage/v1/object/public/logo/logo.png" alt="Ø¹Ù„Ø§Ø¡ Ø§Ù„Ø¯ÙŠÙ†">
    <h1 id="title">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚...</h1>
    <p id="message">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹.</p>

    <div id="resetForm" style="display:none;">
      <input type="password" id="newPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" />
      <input type="password" id="confirmPassword" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
      <button onclick="resetPassword()">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
      <p id="resetStatus"></p>
    </div>

    <footer>
      &copy; 2025 Ø¹Ù„Ø§Ø¡ Ø§Ù„Ø¯ÙŠÙ† - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
    </footer>
  </div>

  <!-- Ù…ÙƒØªØ¨Ø© Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    const params = new URLSearchParams(window.location.search);
    const type = params.get("type");
    const accessToken = params.get("access_token");

    const title = document.getElementById("title");
    const message = document.getElementById("message");
    const resetForm = document.getElementById("resetForm");
    const resetStatus = document.getElementById("resetStatus");

    const supabase = supabase.createClient(
      "https://qgwlcuxrudvdnmryajza.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnd2xjdXhydWR2ZG5tcnlhanphIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTAwMDAwMDAsImV4cCI6MjAwNTU3NjAwMH0.PmYocUOKYoJcX8hUoE-lYyEYcIbnTiX1nK7H6OeRhZ8"
    );

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆÙˆØ¬ÙˆØ¯ accessToken
    if (!type || !accessToken) {
      title.textContent = "Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­ âŒ";
      message.textContent = "ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø±Ø³Ù„ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.";
    } else if (type === "recovery") {
      title.textContent = "Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ğŸ”’";
      message.textContent = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©:";
      resetForm.style.display = "block";
    } else if (type === "signup") {
      title.textContent = "ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰";
      message.textContent = "Ø´ÙƒØ±Ù‹Ø§ Ù„Ø§Ù†Ø¶Ù…Ø§Ù…Ùƒ Ø¥Ù„Ù‰ Ø¹Ø§Ù„Ù… Ø¹Ù„Ø§Ø¡ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø³Ø­Ø±ÙŠ!";
    } else {
      title.textContent = "Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø¹Ù„Ø§Ø¡ Ø§Ù„Ø¯ÙŠÙ†!";
      message.textContent = "Ø§Ø³ØªÙ…ØªØ¹ Ø¨ØªØ¬Ø±Ø¨ØªÙƒ Ù…Ø¹Ù†Ø§ âœ¨";
    }

    async function resetPassword() {
      const newPassword = document.getElementById("newPassword").value;
      const confirmPassword = document.getElementById("confirmPassword").value;

      if (newPassword !== confirmPassword) {
        resetStatus.textContent = "ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†!";
        resetStatus.className = "error";
        return;
      }

      try {
        const { data, error } = await supabase.auth.updateUser(
          { password: newPassword },
          { access_token: accessToken }
        );

        if (error) {
          resetStatus.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«: " + error.message;
          resetStatus.className = "error";
        } else {
          resetStatus.textContent = "ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­ âœ…";
          resetStatus.className = "success";
          resetForm.style.display = "none";
        }
      } catch (err) {
        resetStatus.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹.";
        resetStatus.className = "error";
      }
    }
  </script>
</body>
</html>
